generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String              @id @default(uuid())
  username            String              @unique
  email               String?             @unique
  passwordHash        String              @map("password_hash")
  name                String
  phone               String?
  isActive            Boolean             @default(true) @map("is_active")
  lastLoginAt         DateTime?           @map("last_login_at")
  defaultBaseId       Int?                @map("default_base_id")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  
  // 基地相关关系
  defaultBase         Base?               @relation("UserDefaultBase", fields: [defaultBaseId], references: [id])
  userBases           UserBase[]
  
  // 原有关系
  anchorProfits       AnchorProfit[]      @relation("AnchorProfitCreator")
  arrivalOrders       ArrivalOrder[]      @relation("ArrivalOrderCreator")
  distributionOrders  DistributionOrder[] @relation("DistributionOrderCreator")
  payablePayments     PayablePayment[]    @relation("PayablePaymentCreator")
  payables            Payable[]           @relation("PayableCreator")
  purchaseOrders      PurchaseOrder[]     @relation("PurchaseOrderCreator")
  receivablePayments  ReceivablePayment[] @relation("ReceivablePaymentCreator")
  receivables         Receivable[]        @relation("ReceivableCreator")
  stockConsumptions   StockConsumption[]  @relation("StockConsumptionCreator")
  stockOutOrders      StockOutOrder[]     @relation("StockOutOrderCreator")
  transferOrders      TransferOrder[]     @relation("TransferOrderCreator")
  translationReviews  TranslationReview[] @relation("TranslationReviewer")
  createdTranslations Translation[]       @relation("TranslationCreator")
  updatedTranslations Translation[]       @relation("TranslationUpdater")
  userLocations       UserLocation[]
  userRoles           UserRole[]
  createdPersonnel    Personnel[]         @relation("PersonnelCreator")
  updatedPersonnel    Personnel[]         @relation("PersonnelUpdater")

  @@index([username])
  @@index([email])
  @@index([isActive])
  @@index([defaultBaseId])
  @@map("users")
}

model Role {
  id             String     @id @default(uuid())
  name           String     @unique
  description    String?
  permissions    Json
  isSystem       Boolean    @default(false) @map("is_system")
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")
  descriptionKey String?    @map("description_key")
  nameKey        String?    @map("name_key")
  userRoles      UserRole[]

  @@index([name])
  @@index([nameKey])
  @@index([isSystem])
  @@map("roles")
}

model UserRole {
  id         String    @id @default(uuid())
  userId     String    @map("user_id")
  roleId     String    @map("role_id")
  assignedBy String    @map("assigned_by")
  assignedAt DateTime  @default(now()) @map("assigned_at")
  expiresAt  DateTime? @map("expires_at")
  isActive   Boolean   @default(true) @map("is_active")
  role       Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId, isActive], name: "uk_user_role_active")
  @@index([userId])
  @@index([roleId])
  @@index([expiresAt])
  @@index([isActive])
  @@map("user_roles")
}

model Location {
  id                 String             @id @default(uuid())
  name               String
  type               LocationType
  description        String?
  address            String?
  contactPerson      String?            @map("contact_person")
  contactPhone       String?            @map("contact_phone")
  baseId             Int                @map("base_id")
  isActive           Boolean            @default(true) @map("is_active")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")
  
  // 基地关系
  base               Base               @relation(fields: [baseId], references: [id])
  
  // 原有关系
  anchorProfits      AnchorProfit[]
  arrivalOrders      ArrivalOrder[]
  inventory          Inventory[]
  purchaseOrders     PurchaseOrder[]    @relation("PurchaseOrderTarget")
  stockConsumptions  StockConsumption[]
  stockOutOrders     StockOutOrder[]
  transferOrdersFrom TransferOrder[]    @relation("TransferOrderFrom")
  transferOrdersTo   TransferOrder[]    @relation("TransferOrderTo")
  userLocations      UserLocation[]

  @@index([name])
  @@index([type])
  @@index([isActive])
  @@map("locations")
}

model UserLocation {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  locationId String   @map("location_id")
  createdAt  DateTime @default(now()) @map("created_at")
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, locationId])
  @@index([userId])
  @@index([locationId])
  @@map("user_locations")
}

model Customer {
  id                 String              @id @default(uuid())
  name               String
  contactPerson      String?             @map("contact_person")
  phone              String?
  email              String?
  address            String?
  notes              String?
  baseId             Int?                @map("base_id")
  isActive           Boolean             @default(true) @map("is_active")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  
  // 基地关系 (可选，支持跨基地客户)
  base               Base?               @relation(fields: [baseId], references: [id])
  
  // 原有关系
  distributionOrders DistributionOrder[]
  receivables        Receivable[]

  @@index([phone])
  @@index([isActive])
  @@index([name])
  @@map("customers")
}

model Goods {
  id                     String                  @id @default(uuid())
  code                   String                  @unique
  name                   String
  description            String?
  retailPrice            Decimal                 @default(0) @map("retail_price") @db.Decimal(12, 2)
  purchasePrice          Decimal                 @default(0) @map("purchase_price") @db.Decimal(12, 2)
  boxQuantity            Int                     @default(1) @map("box_quantity")
  packPerBox             Int                     @default(1) @map("pack_per_box")
  piecePerPack           Int                     @default(1) @map("piece_per_pack")
  imageUrl               String?                 @map("image_url")
  notes                  String?
  isActive               Boolean                 @default(true) @map("is_active")
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  
  // 基地相关关系
  goodsBases             GoodsBase[]
  
  // 原有关系
  arrivalOrderItems      ArrivalOrderItem[]
  distributionOrderItems DistributionOrderItem[]
  inventory              Inventory[]
  purchaseOrderItems     PurchaseOrderItem[]
  stockConsumptions      StockConsumption[]
  stockOutOrderItems     StockOutOrderItem[]
  transferOrderItems     TransferOrderItem[]

  @@index([code])
  @@index([name])
  @@index([isActive])
  @@map("goods")
}

model Inventory {
  id            String   @id @default(uuid())
  goodsId       String   @map("goods_id")
  locationId    String   @map("location_id")
  baseId        Int      @map("base_id")
  stockQuantity Int      @default(0) @map("stock_quantity")
  averageCost   Decimal  @default(0) @map("average_cost") @db.Decimal(12, 2)
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  // 关联关系
  goods         Goods    @relation(fields: [goodsId], references: [id], onDelete: Cascade)
  location      Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  base          Base     @relation(fields: [baseId], references: [id])

  @@unique([goodsId, locationId])
  @@index([goodsId])
  @@index([locationId])
  @@index([baseId])
  @@map("inventory")
}

model PurchaseOrder {
  id               String              @id @default(uuid())
  orderNo          String              @unique @map("order_no")
  supplierName     String              @map("supplier_name")
  targetLocationId String              @map("target_location_id")
  baseId           Int                 @map("base_id")
  purchaseDate     DateTime            @map("purchase_date") @db.Date
  totalAmount      Decimal             @default(0) @map("total_amount") @db.Decimal(12, 2)
  notes            String?
  createdBy        String              @map("created_by")
  createdAt        DateTime            @default(now()) @map("created_at")
  updatedAt        DateTime            @updatedAt @map("updated_at")
  
  // 关联关系
  base             Base                @relation(fields: [baseId], references: [id])
  arrivalOrders    ArrivalOrder[]
  payables         Payable[]
  items            PurchaseOrderItem[]
  creator          User                @relation("PurchaseOrderCreator", fields: [createdBy], references: [id])
  targetLocation   Location            @relation("PurchaseOrderTarget", fields: [targetLocationId], references: [id])

  @@index([orderNo])
  @@index([supplierName])
  @@index([targetLocationId])
  @@index([baseId])
  @@index([purchaseDate])
  @@index([createdBy])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String        @id @default(uuid())
  purchaseOrderId String        @map("purchase_order_id")
  goodsId         String        @map("goods_id")
  boxQuantity     Int           @default(0) @map("box_quantity")
  packQuantity    Int           @default(0) @map("pack_quantity")
  pieceQuantity   Int           @default(0) @map("piece_quantity")
  totalPieces     Int           @map("total_pieces")
  unitPrice       Decimal       @map("unit_price") @db.Decimal(12, 2)
  totalPrice      Decimal       @map("total_price") @db.Decimal(12, 2)
  notes           String?
  goods           Goods         @relation(fields: [goodsId], references: [id])
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([purchaseOrderId])
  @@index([goodsId])
  @@map("purchase_order_items")
}

model ArrivalOrder {
  id              String             @id @default(uuid())
  arrivalNo       String             @unique @map("arrival_no")
  purchaseOrderId String             @map("purchase_order_id")
  locationId      String             @map("location_id")
  arrivalDate     DateTime           @map("arrival_date") @db.Date
  notes           String?
  createdBy       String             @map("created_by")
  createdAt       DateTime           @default(now()) @map("created_at")
  items           ArrivalOrderItem[]
  creator         User               @relation("ArrivalOrderCreator", fields: [createdBy], references: [id])
  location        Location           @relation(fields: [locationId], references: [id])
  purchaseOrder   PurchaseOrder      @relation(fields: [purchaseOrderId], references: [id])

  @@index([arrivalNo])
  @@index([purchaseOrderId])
  @@index([locationId])
  @@index([arrivalDate])
  @@map("arrival_orders")
}

model ArrivalOrderItem {
  id             String       @id @default(uuid())
  arrivalOrderId String       @map("arrival_order_id")
  goodsId        String       @map("goods_id")
  quantity       Int
  unitCost       Decimal      @map("unit_cost") @db.Decimal(12, 2)
  notes          String?
  arrivalOrder   ArrivalOrder @relation(fields: [arrivalOrderId], references: [id], onDelete: Cascade)
  goods          Goods        @relation(fields: [goodsId], references: [id])

  @@index([arrivalOrderId])
  @@index([goodsId])
  @@map("arrival_order_items")
}

model TransferOrder {
  id             String              @id @default(uuid())
  transferNo     String              @unique @map("transfer_no")
  fromLocationId String              @map("from_location_id")
  toLocationId   String              @map("to_location_id")
  transferDate   DateTime            @map("transfer_date") @db.Date
  notes          String?
  createdBy      String              @map("created_by")
  createdAt      DateTime            @default(now()) @map("created_at")
  items          TransferOrderItem[]
  creator        User                @relation("TransferOrderCreator", fields: [createdBy], references: [id])
  fromLocation   Location            @relation("TransferOrderFrom", fields: [fromLocationId], references: [id])
  toLocation     Location            @relation("TransferOrderTo", fields: [toLocationId], references: [id])

  @@index([transferNo])
  @@index([fromLocationId])
  @@index([toLocationId])
  @@index([transferDate])
  @@map("transfer_orders")
}

model TransferOrderItem {
  id              String        @id @default(uuid())
  transferOrderId String        @map("transfer_order_id")
  goodsId         String        @map("goods_id")
  quantity        Int
  notes           String?
  goods           Goods         @relation(fields: [goodsId], references: [id])
  transferOrder   TransferOrder @relation(fields: [transferOrderId], references: [id], onDelete: Cascade)

  @@index([transferOrderId])
  @@index([goodsId])
  @@map("transfer_order_items")
}

model StockConsumption {
  id                   String   @id @default(uuid())
  locationId           String   @map("location_id")
  goodsId              String   @map("goods_id")
  consumptionDate      DateTime @map("consumption_date") @db.Date
  openingStock         Int      @default(0) @map("opening_stock")
  closingStock         Int      @default(0) @map("closing_stock")
  arrivalQuantity      Int      @default(0) @map("arrival_quantity")
  transferIn           Int      @default(0) @map("transfer_in")
  transferOut          Int      @default(0) @map("transfer_out")
  stockOut             Int      @default(0) @map("stock_out")
  consumption          Int      @default(0)
  consumptionUnitPrice Decimal  @default(0) @map("consumption_unit_price") @db.Decimal(12, 2)
  consumptionValue     Decimal  @default(0) @map("consumption_value") @db.Decimal(12, 2)
  notes                String?
  createdBy            String   @map("created_by")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  creator              User     @relation("StockConsumptionCreator", fields: [createdBy], references: [id])
  goods                Goods    @relation(fields: [goodsId], references: [id])
  location             Location @relation(fields: [locationId], references: [id])

  @@unique([locationId, goodsId, consumptionDate])
  @@index([locationId])
  @@index([goodsId])
  @@index([consumptionDate])
  @@map("stock_consumption")
}

model DistributionOrder {
  id              String                  @id @default(uuid())
  orderNo         String                  @unique @map("order_no")
  customerId      String                  @map("customer_id")
  totalAmount     Decimal                 @default(0) @map("total_amount") @db.Decimal(12, 2)
  discountPercent Decimal                 @default(0) @map("discount_percent") @db.Decimal(5, 2)
  finalAmount     Decimal                 @default(0) @map("final_amount") @db.Decimal(12, 2)
  orderDate       DateTime                @map("order_date") @db.Date
  notes           String?
  createdBy       String                  @map("created_by")
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  items           DistributionOrderItem[]
  creator         User                    @relation("DistributionOrderCreator", fields: [createdBy], references: [id])
  customer        Customer                @relation(fields: [customerId], references: [id])
  receivables     Receivable[]
  stockOutOrders  StockOutOrder[]

  @@index([orderNo])
  @@index([customerId])
  @@index([orderDate])
  @@index([createdBy])
  @@map("distribution_orders")
}

model DistributionOrderItem {
  id                  String            @id @default(uuid())
  distributionOrderId String            @map("distribution_order_id")
  goodsId             String            @map("goods_id")
  quantity            Int
  unitPrice           Decimal           @map("unit_price") @db.Decimal(12, 2)
  discountPercent     Decimal           @default(0) @map("discount_percent") @db.Decimal(5, 2)
  finalUnitPrice      Decimal           @map("final_unit_price") @db.Decimal(12, 2)
  totalPrice          Decimal           @map("total_price") @db.Decimal(12, 2)
  pendingQuantity     Int               @map("pending_quantity")
  notes               String?
  distributionOrder   DistributionOrder @relation(fields: [distributionOrderId], references: [id], onDelete: Cascade)
  goods               Goods             @relation(fields: [goodsId], references: [id])

  @@index([distributionOrderId])
  @@index([goodsId])
  @@map("distribution_order_items")
}

model StockOutOrder {
  id                  String              @id @default(uuid())
  outNo               String              @unique @map("out_no")
  distributionOrderId String              @map("distribution_order_id")
  locationId          String              @map("location_id")
  outDate             DateTime            @map("out_date") @db.Date
  notes               String?
  createdBy           String              @map("created_by")
  createdAt           DateTime            @default(now()) @map("created_at")
  items               StockOutOrderItem[]
  creator             User                @relation("StockOutOrderCreator", fields: [createdBy], references: [id])
  distributionOrder   DistributionOrder   @relation(fields: [distributionOrderId], references: [id])
  location            Location            @relation(fields: [locationId], references: [id])

  @@index([outNo])
  @@index([distributionOrderId])
  @@index([locationId])
  @@index([outDate])
  @@map("stock_out_orders")
}

model StockOutOrderItem {
  id              String        @id @default(uuid())
  stockOutOrderId String        @map("stock_out_order_id")
  goodsId         String        @map("goods_id")
  quantity        Int
  pendingBefore   Int           @map("pending_before")
  notes           String?
  goods           Goods         @relation(fields: [goodsId], references: [id])
  stockOutOrder   StockOutOrder @relation(fields: [stockOutOrderId], references: [id], onDelete: Cascade)

  @@index([stockOutOrderId])
  @@index([goodsId])
  @@map("stock_out_order_items")
}

model AnchorProfit {
  id               String   @id @default(uuid())
  locationId       String   @map("location_id")
  profitDate       DateTime @map("profit_date") @db.Date
  gmvAmount        Decimal  @default(0) @map("gmv_amount") @db.Decimal(12, 2)
  refundAmount     Decimal  @default(0) @map("refund_amount") @db.Decimal(12, 2)
  offlineAmount    Decimal  @default(0) @map("offline_amount") @db.Decimal(12, 2)
  consumptionValue Decimal  @default(0) @map("consumption_value") @db.Decimal(12, 2)
  adCost           Decimal  @default(0) @map("ad_cost") @db.Decimal(12, 2)
  platformFeeRate  Decimal  @default(0) @map("platform_fee_rate") @db.Decimal(5, 2)
  platformFee      Decimal  @default(0) @map("platform_fee") @db.Decimal(12, 2)
  dailySales       Decimal  @default(0) @map("daily_sales") @db.Decimal(12, 2)
  profitAmount     Decimal  @default(0) @map("profit_amount") @db.Decimal(12, 2)
  profitRate       Decimal  @default(0) @map("profit_rate") @db.Decimal(5, 2)
  notes            String?
  createdBy        String   @map("created_by")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")
  creator          User     @relation("AnchorProfitCreator", fields: [createdBy], references: [id])
  location         Location @relation(fields: [locationId], references: [id])

  @@unique([locationId, profitDate])
  @@index([locationId])
  @@index([profitDate])
  @@map("anchor_profits")
}

model Receivable {
  id                  String              @id @default(uuid())
  distributionOrderId String              @map("distribution_order_id")
  customerId          String              @map("customer_id")
  totalAmount         Decimal             @map("total_amount") @db.Decimal(12, 2)
  receivedAmount      Decimal             @default(0) @map("received_amount") @db.Decimal(12, 2)
  pendingAmount       Decimal             @map("pending_amount") @db.Decimal(12, 2)
  dueDate             DateTime?           @map("due_date") @db.Date
  notes               String?
  createdBy           String              @map("created_by")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  payments            ReceivablePayment[]
  creator             User                @relation("ReceivableCreator", fields: [createdBy], references: [id])
  customer            Customer            @relation(fields: [customerId], references: [id])
  distributionOrder   DistributionOrder   @relation(fields: [distributionOrderId], references: [id])

  @@index([distributionOrderId])
  @@index([customerId])
  @@index([dueDate])
  @@map("receivables")
}

model ReceivablePayment {
  id            String     @id @default(uuid())
  receivableId  String     @map("receivable_id")
  paymentAmount Decimal    @map("payment_amount") @db.Decimal(12, 2)
  paymentDate   DateTime   @map("payment_date") @db.Date
  paymentMethod String?    @map("payment_method")
  notes         String?
  createdBy     String     @map("created_by")
  createdAt     DateTime   @default(now()) @map("created_at")
  creator       User       @relation("ReceivablePaymentCreator", fields: [createdBy], references: [id])
  receivable    Receivable @relation(fields: [receivableId], references: [id], onDelete: Cascade)

  @@index([receivableId])
  @@index([paymentDate])
  @@map("receivable_payments")
}

model Payable {
  id              String           @id @default(uuid())
  purchaseOrderId String           @map("purchase_order_id")
  supplierName    String           @map("supplier_name")
  totalAmount     Decimal          @map("total_amount") @db.Decimal(12, 2)
  paidAmount      Decimal          @default(0) @map("paid_amount") @db.Decimal(12, 2)
  pendingAmount   Decimal          @map("pending_amount") @db.Decimal(12, 2)
  dueDate         DateTime?        @map("due_date") @db.Date
  notes           String?
  createdBy       String           @map("created_by")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  payments        PayablePayment[]
  creator         User             @relation("PayableCreator", fields: [createdBy], references: [id])
  purchaseOrder   PurchaseOrder    @relation(fields: [purchaseOrderId], references: [id])

  @@index([purchaseOrderId])
  @@index([supplierName])
  @@index([dueDate])
  @@map("payables")
}

model PayablePayment {
  id            String   @id @default(uuid())
  payableId     String   @map("payable_id")
  paymentAmount Decimal  @map("payment_amount") @db.Decimal(12, 2)
  paymentDate   DateTime @map("payment_date") @db.Date
  paymentMethod String?  @map("payment_method")
  notes         String?
  createdBy     String   @map("created_by")
  createdAt     DateTime @default(now()) @map("created_at")
  creator       User     @relation("PayablePaymentCreator", fields: [createdBy], references: [id])
  payable       Payable  @relation(fields: [payableId], references: [id], onDelete: Cascade)

  @@index([payableId])
  @@index([paymentDate])
  @@map("payable_payments")
}

model Translation {
  id            String              @id @default(uuid())
  key           String
  language      String
  value         String
  namespace     String?
  description   String?
  isSystem      Boolean             @default(false) @map("is_system")
  isAiGenerated Boolean             @default(false) @map("is_ai_generated")
  reviewStatus  String              @default("pending") @map("review_status")
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  createdBy     String?             @map("created_by")
  updatedBy     String?             @map("updated_by")
  reviews       TranslationReview[]
  creator       User?               @relation("TranslationCreator", fields: [createdBy], references: [id])
  updater       User?               @relation("TranslationUpdater", fields: [updatedBy], references: [id])

  @@unique([key, language])
  @@index([key])
  @@index([language])
  @@index([namespace])
  @@index([reviewStatus])
  @@map("translations")
}

model TranslationReview {
  id            String      @id @default(uuid())
  translationId String      @map("translation_id")
  reviewerId    String      @map("reviewer_id")
  status        String
  comment       String?
  createdAt     DateTime    @default(now()) @map("created_at")
  reviewer      User        @relation("TranslationReviewer", fields: [reviewerId], references: [id])
  translation   Translation @relation(fields: [translationId], references: [id], onDelete: Cascade)

  @@index([translationId])
  @@index([reviewerId])
  @@index([status])
  @@map("translation_reviews")
}

model casbin_rule {
  id         Int       @id @default(autoincrement())
  ptype      String    @db.VarChar(100)
  v0         String    @default("") @db.VarChar(100)
  v1         String    @default("") @db.VarChar(100)
  v2         String    @default("") @db.VarChar(100)
  v3         String?   @db.VarChar(100)
  v4         String?   @db.VarChar(100)
  v5         String?   @db.VarChar(100)
  created_at DateTime? @default(now()) @db.Timestamp(6)

  @@unique([ptype, v0, v1, v2, v3, v4, v5])
  @@index([ptype], map: "idx_casbin_rule_ptype")
  @@index([v0], map: "idx_casbin_rule_v0")
}

enum LocationType {
  WAREHOUSE
  LIVE_ROOM
}

enum PersonnelRole {
  ANCHOR
  WAREHOUSE_KEEPER
}

model Base {
  id            Int      @id @default(autoincrement())
  code          String   @unique
  name          String
  description   String?
  address       String?
  contactPerson String?  @map("contact_person")
  contactPhone  String?  @map("contact_phone")
  contactEmail  String?  @map("contact_email")
  isActive      Boolean  @default(true) @map("is_active")
  createdBy     String   @map("created_by")
  updatedBy     String   @map("updated_by")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // 关联关系 (先实现核心模块)
  userBases           UserBase[]
  goodsBases          GoodsBase[]
  supplierBases       SupplierBase[]
  locations           Location[]
  inventory           Inventory[]
  purchaseOrders      PurchaseOrder[]
  defaultUsers        User[]           @relation("UserDefaultBase")
  customers           Customer[]
  personnel           Personnel[]

  @@index([code])
  @@index([name])
  @@index([isActive])
  @@map("bases")
}

model UserBase {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  baseId    Int      @map("base_id")
  roles     String[] @default([])
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  base Base @relation(fields: [baseId], references: [id], onDelete: Cascade)

  @@unique([userId, baseId])
  @@index([userId])
  @@index([baseId])
  @@index([isActive])
  @@map("user_bases")
}

model GoodsBase {
  id            String   @id @default(uuid())
  goodsId       String   @map("goods_id")
  baseId        Int      @map("base_id")
  isActive      Boolean  @default(true) @map("is_active")
  retailPrice   Decimal? @map("retail_price") @db.Decimal(12, 2)
  purchasePrice Decimal? @map("purchase_price") @db.Decimal(12, 2)
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  goods Goods @relation(fields: [goodsId], references: [id], onDelete: Cascade)
  base  Base  @relation(fields: [baseId], references: [id], onDelete: Cascade)

  @@unique([goodsId, baseId])
  @@index([goodsId])
  @@index([baseId])
  @@index([isActive])
  @@map("goods_bases")
}

model Supplier {
  id          String   @id @default(uuid())
  code        String   @unique
  name        String
  contactPerson String? @map("contact_person")
  phone       String?
  email       String?
  address     String?
  taxNumber   String?  @map("tax_number")
  bankAccount String?  @map("bank_account")
  bankName    String?  @map("bank_name")
  notes       String?
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  supplierBases SupplierBase[]

  @@index([code])
  @@index([name])
  @@index([isActive])
  @@map("suppliers")
}

model SupplierBase {
  id             String   @id @default(uuid())
  supplierId     String   @map("supplier_id")
  baseId         Int      @map("base_id")
  isActive       Boolean  @default(true) @map("is_active")
  paymentTerms   String?  @map("payment_terms")
  deliveryTerms  String?  @map("delivery_terms")
  creditLimit    Decimal  @default(0) @map("credit_limit") @db.Decimal(12, 2)
  notes          String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  supplier Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  base     Base     @relation(fields: [baseId], references: [id], onDelete: Cascade)

  @@unique([supplierId, baseId])
  @@index([supplierId])
  @@index([baseId])
  @@index([isActive])
  @@map("supplier_bases")
}

model Personnel {
  id        String        @id @default(uuid())
  code      String        @unique
  name      String
  role      PersonnelRole
  phone     String?
  email     String?
  notes     String?
  baseId    Int           @map("base_id")
  isActive  Boolean       @default(true) @map("is_active")
  createdBy String?       @map("created_by")
  updatedBy String?       @map("updated_by")
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")

  base    Base  @relation(fields: [baseId], references: [id], onDelete: Cascade)
  creator User? @relation("PersonnelCreator", fields: [createdBy], references: [id])
  updater User? @relation("PersonnelUpdater", fields: [updatedBy], references: [id])

  @@index([code])
  @@index([name])
  @@index([role])
  @@index([baseId])
  @@index([isActive])
  @@map("personnel")
}
