# 快速开始指南

## 📋 前置检查清单

在开始数据迁移之前，请确认以下事项：

- [ ] 已备份数据库
- [ ] 系统中已创建至少一个基地
- [ ] 系统中已创建必要的仓库/直播间
- [ ] 已安装 Node.js (v16+)
- [ ] CSV 文件编码为 UTF-8

## 🚀 快速开始

### 1. 安装依赖

```bash
cd scripts/data-migration
npm install
```

### 2. 配置参数

编辑 `src/config.js`，设置你的基地ID：

```javascript
defaults: {
  baseId: 1, // 修改为你的基地ID
}
```

### 3. 转换数据

```bash
npm run convert
```

这将读取 `doc/wilddata/` 目录下的 CSV 文件，并转换为 JSON 格式。

转换后的文件保存在 `output/converted/` 目录：
- `goods.json` - 商品数据
- `categories.json` - 品类数据
- `arrivals.json` - 到货记录
- `stockouts.json` - 出库记录
- `transfers.json` - 调货记录

### 4. 验证数据（可选）

检查转换后的数据是否正确：

```bash
# 查看商品数据
cat output/converted/goods.json | head -n 50

# 查看错误日志
cat output/logs/goods_errors.json
```

### 5. 测试导入

**重要**：先在测试模式下运行，不会真正写入数据库：

```bash
npm run import:goods -- --dry-run
```

查看输出，确认没有问题。

### 6. 正式导入

**⚠️ 警告**：这将真正写入数据库，请确保已备份！

```bash
# 导入商品数据
npm run import:goods

# 如果需要指定基地ID
npm run import:goods -- --base-id=2
```

## 📊 导入顺序

**必须按以下顺序导入**：

1. ✅ **商品数据** (已完成脚本)
   ```bash
   npm run import:goods
   ```

2. 🚧 **到货记录** (需要先手动创建采购订单)
   ```bash
   # 暂时跳过，或手动创建采购订单后再导入
   ```

3. 🚧 **出库记录** (需要先创建人员和仓库)
   ```bash
   # 暂时跳过
   ```

4. 🚧 **调货记录** (需要先创建人员和仓库)
   ```bash
   # 暂时跳过
   ```

## 🔧 常见问题

### Q1: 编码错误怎么办？

如果遇到编码问题，使用以下命令转换：

```bash
# Windows (需要安装 iconv)
iconv -f GB18030 -t UTF-8 input.csv > output.csv

# 或者用记事本打开，另存为 UTF-8 编码
```

### Q2: 基地ID在哪里查看？

登录系统后，在基地管理页面查看基地ID，或执行 SQL：

```sql
SELECT id, code, name FROM bases;
```

### Q3: 导入失败了怎么办？

1. 查看错误日志：`output/logs/`
2. 查看导入报告：`output/reports/`
3. 如果需要重新导入，先删除已导入的数据：

```sql
-- 删除商品（谨慎操作！）
DELETE FROM goods_local_settings WHERE base_id = 1;
DELETE FROM goods WHERE code LIKE '10%';
```

### Q4: 如何只导入部分数据？

编辑转换后的 JSON 文件，删除不需要的记录，然后重新导入。

### Q5: 价格数据怎么办？

当前脚本将价格设置为 0，需要后续手动在系统中设置。

或者你可以提供价格数据的 CSV 文件，我可以帮你添加价格导入功能。

## 📝 下一步计划

当前已完成：
- ✅ 商品数据转换和导入脚本
- ✅ 到货/出库/调货记录转换脚本

待完成：
- 🚧 人员数据导入（需要先了解 `主播和运营.CSV` 的结构）
- 🚧 采购订单导入（需要先创建供应商）
- 🚧 到货/出库/调货记录导入（需要先完成人员和仓库数据）

## 💡 建议的导入策略

### 方案 A：最小化导入（推荐）

只导入商品数据，其他数据在新系统中重新录入：

1. 导入商品数据 ✅
2. 在系统中手动创建人员、仓库
3. 在系统中手动录入近期的库存数据

**优点**：简单、安全、数据干净
**缺点**：需要手动录入部分数据

### 方案 B：完整导入

导入所有历史数据：

1. 导入商品数据
2. 创建人员映射表（旧姓名 → 新系统人员ID）
3. 创建仓库映射表（旧仓库名 → 新系统仓库ID）
4. 导入历史库存记录

**优点**：保留完整历史数据
**缺点**：复杂、耗时、可能有数据不一致

## 🆘 需要帮助？

如果遇到问题，请提供：
1. 错误日志内容
2. 导入报告内容
3. 具体的错误信息

我会帮你解决！
