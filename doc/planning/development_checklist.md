# 开发前确认清单

> 本文档用于记录开发前需要确定的各项问题，大部分问题不影响开发主流程，可以在开发过程中逐步确定和调整。

## 📋 问题分类

### 🔴 高优先级（必须确定）
影响系统架构和核心功能，需要在开发前确定

### 🟡 中优先级（尽快确定）
影响开发效率和用户体验，建议早期确定

### 🟢 低优先级（可后续调整）
可以在开发过程中迭代优化

---

## 1. 数据模型设计 🗄️ 🔴

### 1.1 核心实体关系
**问题：** 用户-角色关系设计
- [x] 用户-角色是多对多还是一对多？ ✅ **多对多关系**
- [x] 是否需要角色继承？ ✅ **不使用继承，避免复杂度**
- [x] 临时权限如何处理？ ✅ **角色分配支持时效设置，以天为单位**

**已确定方案：** 多对多关系，用户可同时拥有多个角色，每个角色分配可设置有效期

**问题：** 商品SKU管理
- [x] 是否需要SKU概念（同一商品的不同规格）？ ✅ **暂不需要SKU**
- [x] 商品编码规则？ ✅ **系统自动生成**
- [x] 商品分类层级？ ✅ **暂不需要分类**

**已确定方案：** 一个商品一个记录，系统自动生成编码

**问题：** 库存维度设计
- [x] 库存是按商品+地点还是有更细的维度？ ✅ **商品+地点二维库存**
- [x] 是否需要批次管理？ ✅ **不需要批次管理**
- [x] 保质期管理？ ✅ **不需要保质期管理**

**已确定方案：** 商品+地点（仓库/直播间）二维库存，支持箱/盒/包单位换算

### 1.2 关键字段定义
**问题：** 数据精度和类型
- [x] 价格精度？ ✅ **Decimal(12,2) 支持千万级金额**
- [x] 库存是否支持小数？ ✅ **整数，不支持小数**
- [x] 单位管理方式？ ✅ **枚举方式，后续可扩展为单位表**

**已确定方案：**
- 价格使用 Decimal(12,2)
- 库存使用整数
- 单位使用枚举
- 单位换算：一箱=N盒，一盒=M包（商品录入时确定）

### 1.3 用户业务实体关联
**问题：** 用户与业务实体关系
- [x] 主播与直播间关系？ ✅ **一个主播可以管理多个直播间**
- [x] 仓管与仓库关系？ ✅ **一个仓管可以管理多个仓库**
- [x] 关联关系是否需要时效性？ ✅ **不需要时效性**

**已确定方案：** 多对多关系，无时效限制

### 1.4 业务流程状态管理
**问题：** 单据状态流转
- [x] 采购单是否需要状态流转？ ✅ **不需要，仅用于数据录入和统计**
- [x] 分销单是否需要状态管理？ ✅ **不需要状态触发机制**
- [x] 系统是否需要工作流？ ✅ **暂不需要，专注数据录入**

**已确定方案：** 所有单据仅支持录入，无状态流转，主要用于统计分析

---

## 2. 业务规则细节 📋 🔴

### 2.1 库存计算逻辑
**问题：** 消耗公式确认
- [x] 消耗公式：`消耗 = 期初 + 到货 + 调入 - 调出 - 期末 - 出库` ✅已确认

**问题：** 负库存处理
- [ ] 是否允许负库存？
- [ ] 负库存时的业务处理流程？
- [ ] 库存预警阈值设置？

**当前假设：** 不允许负库存，操作前检查库存充足性

### 2.2 财务计算规则
**问题：** 成本计算方法
- [ ] FIFO（先进先出）
- [ ] LIFO（后进先出）
- [ ] 加权平均成本
- [ ] 其他方法？

**当前假设：** 使用加权平均成本法

**问题：** 多币种支持
- [ ] 是否涉及多币种？
- [ ] 汇率处理策略？
- [ ] 汇率更新频率？

**当前假设：** 暂只支持人民币

**问题：** 税费计算
- [ ] 是否需要考虑增值税？
- [ ] 其他税费类型？
- [ ] 税率配置方式？

**当前假设：** 暂不考虑税费

### 2.3 权限系统实现方案
**问题：** 权限管理技术选型
- [x] 使用开源库还是自研？ ✅ **使用 Casbin 开源库**
- [x] 权限模型设计？ ✅ **RBAC模型 + 自定义数据权限扩展**
- [x] 数据权限实现方式？ ✅ **API层过滤 + 查询层过滤**

**已确定方案：** 
- 基础权限：Casbin 实现页面访问和功能操作权限
- 数据权限：自定义实现字段级和行级权限过滤
- 权限模型：多对多用户角色关系，支持角色时效管理

**权限分级结构：**
```typescript
// 三级权限：模块:功能:操作:字段
"inventory:goods:view:price"  // 查看商品价格
"finance:profit:edit:own"     // 编辑自己的利润数据
```

**角色权限矩阵：**
- 超级管理员：["*"] 
- 老板：["inventory:*", "sales:*", "finance:*"]
- 财务：["inventory:goods:view:price", "finance:*", ...]
- 仓管：["inventory:*", "sales:stockout:*", ...]  
- 主播：["inventory:consumption:*", "finance:profit:view:own", ...]

---

## 3. 技术实现细节 ⚙️ 🟡

### 3.1 认证授权策略
**问题：** JWT配置
- [ ] JWT过期时间？（建议：2小时）
- [ ] 是否需要刷新令牌？
- [ ] 记住登录功能？

**问题：** 密码策略
- [ ] 密码复杂度要求？
- [ ] 密码有效期？
- [ ] 密码重置流程？

**问题：** 多设备登录
- [ ] 是否允许同一用户多设备同时登录？
- [ ] 设备管理功能？

**当前假设：** JWT 2小时过期，支持多设备登录

### 3.2 文件上传策略
**问题：** 存储方案
- [ ] 本地存储
- [ ] 阿里云OSS
- [ ] 腾讯云COS
- [ ] 其他云存储？

**问题：** 文件管理
- [ ] 支持的文件类型？
- [ ] 文件大小限制？
- [ ] 是否需要缩略图？
- [ ] 文件清理策略？

**当前假设：** 本地存储，支持常见图片和Excel格式

### 3.3 数据导入导出
**问题：** Excel模板设计
- [ ] 具体的字段映射规则？
- [ ] 数据验证策略？
- [ ] 错误提示方式？

**问题：** 批量操作性能
- [ ] 单次导入数据量限制？
- [ ] 大批量数据的处理策略？
- [ ] 进度显示？

**问题：** 错误处理
- [ ] 导入失败时的回滚策略？
- [ ] 部分成功的处理方式？

**当前假设：** 标准Excel格式，单次限制1000条

---

## 4. 部署和运维 🚀 🟡

### 4.1 环境配置
**问题：** 必需的环境变量
```bash
DATABASE_URL=?          # 数据库连接
JWT_SECRET=?            # JWT密钥
UPLOAD_PATH=?           # 文件上传路径
LOG_LEVEL=?             # 日志级别
REDIS_URL=?             # 是否需要Redis？
NODE_ENV=?              # 环境标识
PORT=?                  # 服务端口
```

**当前假设：** 暂不使用Redis，其他按标准配置

### 4.2 备份策略
**问题：** 数据备份
- [ ] 数据库备份频率？（建议：每日）
- [ ] 备份保留时间？（建议：30天）
- [ ] 文件备份策略？

**问题：** 灾难恢复
- [ ] RTO（恢复时间目标）？
- [ ] RPO（恢复点目标）？
- [ ] 备份验证流程？

**当前假设：** 每日数据库备份，保留30天

### 4.3 监控告警
**问题：** 监控指标
- [ ] 关键性能指标？
- [ ] 业务指标监控？
- [ ] 告警阈值设置？

**问题：** 告警方式
- [ ] 邮件通知？
- [ ] 短信通知？
- [ ] 钉钉/企业微信？

**当前假设：** 基础监控，邮件告警

---

## 5. 用户体验设计 🎨 🟢

### 5.1 界面交互
**问题：** 表格展示
- [ ] 默认每页显示条数？（建议：20条）
- [ ] 表格列的默认排序？
- [ ] 筛选条件保存？

**问题：** 搜索体验
- [ ] 实时搜索还是点击搜索？
- [ ] 搜索历史记录？
- [ ] 高级搜索功能？

**问题：** 操作确认
- [ ] 哪些操作需要二次确认？
- [ ] 删除操作的确认方式？
- [ ] 批量操作确认？

**当前假设：** 20条/页，点击搜索，删除需要确认

### 5.2 数据展示
**问题：** 格式标准
- [ ] 日期格式？（建议：YYYY-MM-DD）
- [ ] 时间格式？（建议：HH:mm:ss）
- [ ] 金额显示？（建议：保留2位小数，千分位分隔）
- [ ] 状态显示方式？（建议：颜色+文字）

**当前假设：** 标准格式，金额保留2位小数

### 5.3 移动端适配
**问题：** 移动端需求
- [ ] 是否需要移动端？
- [ ] 主播是否需要手机端录入？
- [ ] 响应式设计优先级？

**当前假设：** 暂不考虑移动端，桌面端优先

---

## 6. 数据迁移和初始化 📊 🟡

### 6.1 历史数据
**问题：** 数据迁移
- [ ] 是否有历史数据需要迁移？
- [ ] 历史数据格式？
- [ ] 数据清洗规则？
- [ ] 迁移时间安排？

**当前假设：** 全新系统，无历史数据迁移

### 6.2 初始数据
**问题：** 系统初始化
- [ ] 默认管理员账号？
- [ ] 预置角色和权限？
- [ ] 基础数据（商品分类、单位等）？
- [ ] 测试数据准备？

**当前假设：** 创建默认管理员，基础角色权限

---

## 7. 集成和扩展 🔗 🟢

### 7.1 第三方集成
**问题：** 支付系统
- [ ] 是否需要对接支付宝？
- [ ] 是否需要对接微信支付？
- [ ] 其他支付方式？

**问题：** 其他集成
- [ ] 物流系统对接？
- [ ] ERP系统集成？
- [ ] 财务软件对接？

**当前假设：** 暂不考虑第三方集成

### 7.2 API设计
**问题：** API规范
- [ ] 版本控制策略？（建议：/api/v1/）
- [ ] 限流策略？
- [ ] API文档工具？（建议：Swagger）

**当前假设：** 使用版本控制，Swagger文档

---

## 8. 安全和合规 🔒 🟡

### 8.1 数据安全
**问题：** 敏感数据保护
- [ ] 价格、成本等敏感字段是否加密存储？
- [ ] 操作审计日志？
- [ ] 数据脱敏策略？

**问题：** 访问控制
- [ ] IP白名单？
- [ ] 操作日志记录？
- [ ] 异常登录检测？

**当前假设：** 基础安全措施，重要操作记录日志

### 8.2 合规要求
**问题：** 法律合规
- [ ] 个人信息保护法合规？
- [ ] 财务数据合规要求？
- [ ] 数据跨境传输？

**当前假设：** 内部系统，基础合规即可

---

## 📝 填写说明

1. **优先级标识**：🔴 高优先级 🟡 中优先级 🟢 低优先级
2. **状态标记**：
   - [ ] 待确定
   - [x] 已确定 ✅
   - [?] 需要讨论 ❓
3. **当前假设**：开发可以基于这些假设开始，后续可调整

---

**文档版本：** v1.0  
**创建时间：** 2025-11-16  
**最后更新：** 2025-11-16  
**维护者：** 开发团队

> 💡 **使用建议：** 可以逐步填写这个清单，大部分问题不会阻塞开发进度。建议先基于"当前假设"开始开发，在开发过程中根据实际需要调整。
