# 模块：分销管理

- **参考截图**: `14_分销.png`
- **URL**: `/live-base/sales/distributions`

---

## 1. 功能概述

此页面用于创建和管理面向分销客户的销售订单，主要用于线下渠道的分销。

**核心业务逻辑**: 创建分销单后，系统会自动在“应收”模块同步生成一条应收记录。收款操作应在“应收”模块进行，支持分批收款。

**特殊用途**: 此模块也可用于处理“供应商退货”。操作方法是先将供应商添加为“客户”，然后创建一张分销单来记录退货的商品和金额。

---

## 2. 页面布局与功能

### 2.1 搜索与操作

- **搜索**: 
  - 页面顶部提供多个筛选条件：
    - **分销客户**: 按客户筛选。
    - **出库状态**: 按订单的出库状态（如：未出库、部分出库、已出库）筛选。
    - **仓库**: 按销售发生的仓库筛选。
    - **日期范围**: 按销售日期范围筛选。
  - 点击“搜索” (Search) 按钮后，下方列表根据条件进行过滤。
- **主要操作**:
  - **添加 (Add)**: 点击跳转到“添加分销订单”页面。
  - **导入 (Import)**: 批量导入分销订单。
  - **导出 (Export)**: 导出分销订单列表。

### 2.2 分销列表

- **数据展示**: 页面主体为一个表格，展示分销订单的详细信息。
- **分页**: 表格下方应有分页组件。
- **表格列**:
  - **ID**: 唯一标识符。
  - **日期**: 销售日期。
  - **名称**: 订单名称或摘要。
  - **分销客户**: 购买商品的客户。
  - **商品**: 销售的商品。
  - **零售价**: 商品的标准零售价。
  - **折扣%**: 该订单享受的折扣百分比。
  - **销售箱/盒/包**: 本次销售的总数量（分单位）。
  - **待出库箱/盒/包**: 尚未完成出库的数量（分单位）。
  - **销售单价/结**: 经过折扣等计算后的最终结算单价。
  - **操作**:
    - **删除 (Del)**: 点击后，应弹出确认对话框，确认后删除该分销记录。

---

## 3. 数据模型

```typescript
// file: src/models/distribution.ts

export interface DistributionOrder {
  id: number;
  date: string;
  name: string;
  customerId: number; // 关联分销客户
  goodsId: number; // 关联商品
  retailPrice: number;
  discount: number; // e.g., 60.00 for 60%
  finalUnitPrice: number; // 销售单价/结

  // 销售数量
  salesQuantityBox: number;
  salesQuantityUnit: number;
  salesQuantitySubUnit: number;

  // 待出库数量
  pendingStockOutBox: number;
  pendingStockOutUnit: number;
  pendingStockOutSubUnit: number;
}
```

---

## 4. 已确认的业务规则

1.  **结算单价计算**: `销售单价/结` = `零售价` * (1 - `折扣%` / 100)。
2.  **待出库数量**: 该字段由系统自动计算。初始值为销售数量，每当在“出库管理”模块创建一条关联的出库记录，该字段的值会自动扣减。
3.  **编辑功能**: 分销订单一旦创建不允许修改。如需更正，应删除后重新创建。
