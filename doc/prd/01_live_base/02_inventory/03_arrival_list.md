# 模块：到货管理

- **参考截图**: `7_到货.png`
- **URL**: `/live-base/inventory/arrivals`

---

## 1. 功能概述

此页面用于记录采购商品的到货情况。到货记录必须关联一个已存在的采购单，支持一张采购单分批多次到货。

**核心业务逻辑**: 登记到货单时，选择的到货地点应为“仓库”。到货成功后，系统会自动将到货数量叠加到“仓库”模块中对应商品的库存上。

---

## 2. 页面布局与功能

### 2.1 搜索与操作

- **搜索**: 
  - 页面顶部提供多个筛选条件：
    - **仓库**: 按到货仓库筛选。
    - **采购单**: 按关联的采购订单筛选。
    - **商品**: 按到货的商品筛选。
    - **经手人**: 按处理到货的人员筛选。
    - **日期范围**: 按到货日期范围筛选。
  - 点击“搜索” (Search) 按钮后，下方列表根据条件进行过滤。
- **主要操作**:
  - **添加 (Add)**: 点击跳转到“添家到货记录”页面。
  - **导入 (Import)**: 批量导入到货记录（Excel格式）。
  - **导出 (Export)**: 导出到货记录列表（Excel格式）。

### 2.2 到货列表

- **数据展示**: 页面主体为一个表格，展示到货记录的详细信息。
- **分页**: 表格下方应有分页组件。
- **表格列**:
  - **ID**: 唯一标识符。
  - **日期**: 到货日期。
  - **采购**: 关联的采购订单名称或编号。
  - **商品**: 到货的商品名称。
  - **仓库**: 接收货物的仓库。
  - **经手**: 处理该次到货的人员（仓管）。
  - **到货箱**: 本次到货数量（单位：箱）。
  - **到货盒**: 本次到货数量（单位：盒）。
  - **到货包**: 本次到货数量（单位：包）。
  - **创建时间**: 记录的创建日期和时间。
  - **操作**:
    - **删除 (Del)**: 点击后，应弹出确认对话框，确认后删除该到货记录。

---

## 3. 数据模型

```typescript
// file: src/models/arrival.ts

export interface ArrivalRecord {
  id: number;
  date: string; // ISO 8601 format
  purchaseOrderId: number; // 关联采购单
  goodsId: number; // 关联商品
  warehouseId: number; // 关联仓库
  handlerId: number; // 关联经手人

  // 到货数量
  quantityBox: number;
  quantityUnit: number; // 盒
  quantitySubUnit: number; // 包

  createdAt: string;
}
```

---

## 4. 已确认的业务规则

1.  **关联采购单**: 添加到货记录时 **必须** 关联一个采购订单。
2.  **编辑功能**: 到货记录一旦创建后不允许修改。如需更正，应删除后重新创建。
3.  **溢出处理**: 如果实际到货数量多于采购数量，应将多出的部分视为赠品，并为其单独创建一张采购价为0的采购单和对应的到货单。系统会自动处理平均采购成本。
