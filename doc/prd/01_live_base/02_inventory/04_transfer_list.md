# 模块：调货管理

- **参考截图**: `8_调货.png`
- **URL**: `/live-base/inventory/transfers`

---

## 1. 功能概述

此页面用于记录和管理商品在不同地点（仓库、直播间）或人员（主播、仓管）之间的调拨。支持直播间之间的调拨，也支持通过设立“虚拟公共仓”来实现更灵活的中转。

**核心业务逻辑**: 调货主要用于从“仓库”向“直播间”补货。调货记录会自动更新到“库存及消耗”表中对应的直播间和商品条目下。

---

## 2. 页面布局与功能

### 2.1 搜索与操作

- **搜索**: 
  - 页面顶部提供多个筛选条件：
    - **调出直播间/仓库**: 按调出方筛选。
    - **调出主播**: 按调出人员筛选。
    - **调入直播间/仓库**: 按调入方筛选。
    - **调入主播**: 按调入人员筛选。
    - **商品**: 按调拨的商品筛选。
    - **日期范围**: 按调货日期范围筛选。
  - 点击“搜索” (Search) 按钮后，下方列表根据条件进行过滤。
- **主要操作**:
  - **添加 (Add)**: 点击跳转到“添加调货记录”页面。
  - **导入 (Import)**: 批量导入调货记录。
  - **导出 (Export)**: 导出调货记录列表。

### 2.2 调货列表

- **数据展示**: 页面主体为一个表格，展示调货记录的详细信息。
- **分页**: 表格下方应有分页组件。
- **表格列**:
  - **ID**: 唯一标识符。
  - **日期**: 调货日期。
  - **商品**: 调拨的商品名称。
  - **调出直播间/仓库**: 货物的来源地。
  - **调出主播**: 货物的来源经手人。
  - **调入直播间/仓库**: 货物的目的地。
  - **调入主播**: 货物的目标经手人。
  - **调拨箱/盒/包**: 本次调拨的数量（分单位）。
  - **备注**: 显示一个备注图标，点击或悬浮可查看详细备注信息。
  - **创建时间**: 记录的创建日期和时间。
  - **操作**:
    - **删除 (Del)**: 点击后，应弹出确认对话框，确认后删除该调货记录。

---

## 3. 数据模型

```typescript
// file: src/models/stockTransfer.ts

export interface StockTransfer {
  id: number;
  date: string; // ISO 8601 format
  goodsId: number;

  sourceLocationId: number; // 调出直播间/仓库 ID
  sourceHandlerId: number; // 调出主播 ID
  destinationLocationId: number; // 调入直播间/仓库 ID
  destinationHandlerId: number; // 调入主播 ID

  // 调拨数量
  quantityBox: number;
  quantityUnit: number; // 盒
  quantitySubUnit: number; // 包

  notes?: string;
  createdAt: string;
}
```

---

## 4. 已确认的业务规则

1.  **调拨逻辑**: 调拨可以发生在“仓库到直播间”、“直播间到直播间”等多种场景。调出/入主播和调出/入地点是共同定义一条完整的调拨路径。
2.  **时间点**: 调货操作必须在直播间盘点**期初库存之后**进行，调货数量不应包含在期初库存内。调货日期应与“库存及消耗”的日期保持一致。
3.  **编辑功能**: 调货记录一旦创建不允许修改。
4.  **备注功能**: 交互方式为点击图标后弹出包含备注文本的模态框。
