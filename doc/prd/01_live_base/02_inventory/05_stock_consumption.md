# 模块：库存及消耗

- **参考截图**: `9_库存和消耗.png`
- **URL**: `/live-base/inventory/stock-ledger`

---

## 1. 功能概述

此页面是**仅供直播间使用**的库存消耗流水账，与“主播利润表”强关联，不应在此登记仓库的库存。

**核心业务逻辑**: 主播在此登记当日直播商品的期初和期末库存。系统会根据关联的“到货”、“调货”、“出库”记录，以及商品的采购价，自动计算出当日的“消耗数量”和“消耗金额”，并同步到“主播利润”表中。

---

## 2. 页面布局与功能

### 2.1 搜索与操作

- **搜索**: 
  - 页面顶部提供筛选条件：
    - **直播间**: 按直播间筛选。
    - **主播**: 按主播筛选。
    - **日期范围**: 按记录日期范围筛选。
  - 点击“搜索” (Search) 按钮后，下方列表根据条件进行过滤。
- **主要操作**:
  - **添加 (Add)**: 点击跳转到“添加库存记录”页面。
  - **导入 (Import)**: 批量导入库存记录。
  - **导出 (Export)**: 导出库存记录列表。

### 2.2 库存流水列表

- **数据展示**: 页面主体为一个非常详细的表格，展示每日的库存变动。
- **分页**: 表格下方应有分页组件。
- **表格列**:
  - **ID**: 唯一标识符。
  - **日期**: 记录的日期。
  - **商品**: 涉及的商品。
  - **直播间**: 关联的直播间。
  - **主播**: 关联的主播。
  - **期初箱/盒/包**: 当天开始时的库存数量。
  - **到货箱/盒/包**: 当天通过采购到货的数量。
  - **调入箱/盒/包**: 当天从别处调入的数量。
  - **调出箱/盒/包**: 当天调出到别处的数量。
  - **备注**: 文本备注字段。
  - **操作**:
    - **编辑 (Edit)**: 点击后，跳转到对应的编辑页面。
    - **删除 (Del)**: 点击后，应弹出确认对话框，确认后删除该记录。

---

## 3. 数据模型

```typescript
// file: src/models/stockLedger.ts

export interface StockLedgerEntry {
  id: number;
  date: string;
  goodsId: number;
  liveRoomId: number;
  anchorId: number;

  // 期初库存
  openingStockBox: number;
  openingStockUnit: number;
  openingStockSubUnit: number;

  // 当日变动
  arrivalBox: number;
  arrivalUnit: number;
  arrivalSubUnit: number;

  transferInBox: number;
  transferInUnit: number;
  transferInSubUnit: number;

  transferOutBox: number;
  transferOutUnit: number;
  transferOutSubUnit: number;

  notes?: string;
}
```

---

## 4. 已确认的业务规则

1.  **数据录入**: “期初库存”和“期末库存”（截图右侧未显示）由主播在每日盘点后手动录入。
2.  **数据同步**: “到货”、“调入”、“调出”、“出库”等数据，由系统根据其他模块的记录自动同步至此。
3.  **消耗计算公式**: `消耗 = 期初 + 到货 + 调入 - 调出 - 期末 - 出库`。
    - “消耗”是一个计算字段，不在表格中直接显示，但其计算结果（消耗数量 * 采购成本）会作为“实际消耗货值”同步到“主播利润”表中。
4.  **数据修正**: 如果发现“库存及消耗”表的自动计算结果与“主播利润”表不一致，应在“主播利润”表手动点击“刷新”按钮来强制同步。
